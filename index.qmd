---
title: "IPGTT Data Cleaning and Analysis"
---



### Data Dictionary


```{r setup, include=FALSE}

# Importing necessary libraries
library(dplyr)
library(ggplot2)
library(plotly)
library(readxl)
library(stringr)

okabe_ito_palette <- c("#D55E00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#E69F00", "#CC79A7", "#999999")
```

| Name            | Data Type | Description                                            | Unit of Measurement |
|------------------|------------------|-------------------|------------------|
| mouse_id        | chr       | Unique identifier for each mouse                       | *NA*                |
| mouse           | chr       | Identifier or name assigned to each mouse              | *NA*                |
| genotype        | factor    | Genetic constitution of each mouse (e.g., WT, Het, KO) | *NA*                |
| sex             | factor    | Sex of the mouse (e.g., Male, Female)                  | *NA*                |
| test_week       | num       | Week number when the test was conducted                | weeks               |
| time_point      | num       | Specific time point at which data was collected        | min                 |
| body_weight     | num       | Body weight of the mouse                               | g                   |
| glucose reading | num       | Blood glucose level of the mouse                       | mg/dL               |

### Cleaning

##### Filtering Unnecessary Data:

```{r}
# Reading excel database
IPGTT_tidy_data_corrected <- read_excel("C:/Users/dhana/Desktop/ISB/DataFrames/T1D/data/IPGTT_tidy_data_corrected.xlsx")
summary(IPGTT_tidy_data_corrected)

```

```{r}

# Removing Mouse and nan data values that were created during ChatGPT analysis
IPGTT_data <- IPGTT_tidy_data_corrected %>% filter(Mouse != "Mouse")
IPGTT_data <- IPGTT_data %>% filter(Mouse != "nan")

# Removing all rows where there are no body weight AND glucose readings
IPGTT_data <- IPGTT_data %>% filter(!(is.na(BW) & is.na(`Glucose Reading`)))

```

##### Changing variable names according to Tidy Data guidelines

```{r}
old_names <- names(IPGTT_data)

new_names <- c("mouse", "body_weight", "test_week", "genotype", "sex", "time_point", "glucose_reading")
names(IPGTT_data) <- new_names
```

##### Creating unique mouse ID's depending on its name and genotype

```{r}
IPGTT_data <- IPGTT_data %>% mutate(mouse_id = paste(mouse, genotype, sep = "-"))
```

##### Converting time_point from char to numeric

```{r}
IPGTT_data <- IPGTT_data %>% mutate(time_point = as.numeric(str_extract(time_point, "\\d+")))
```

##### Factors

```{r}
IPGTT_data$sex <-  factor(IPGTT_data$sex)
IPGTT_data$genotype <- factor(IPGTT_data$genotype)

# Checking to see if data type changed
str(IPGTT_data)
```

##### Relocating columns for easier readability

```{r}
IPGTT_data <- IPGTT_data %>%
  select(mouse_id, mouse, genotype, sex, test_week, time_point, body_weight, glucose_reading, everything())
```

\


### Visualizations

```{r}
#IPGTT trajectories overlaid with within-genotype medians

IPGTT_fil <- IPGTT_data %>% filter(!is.na(glucose_reading), test_week %in% 1:4)

median_data <- IPGTT_data %>% filter(!is.na(glucose_reading), test_week %in% 1:4)  %>% 
  group_by(time_point, genotype, test_week) %>%
  summarise(median_glucose_reading = median(glucose_reading, na.rm = TRUE))

plot1 <- ggplot(IPGTT_fil, aes(time_point, glucose_reading, color = genotype, group = mouse_id)) +
  geom_line(alpha = 0.3) +
  geom_line(data = median_data, aes(x = time_point, y = median_glucose_reading, color = genotype, group = genotype)) + 
  facet_wrap(~ test_week,  ncol = 4) +
  theme_minimal() +
  scale_x_continuous(breaks=seq(0,120, by=30)) +
  scale_color_manual(values = okabe_ito_palette) +
  labs(title = "IPGTT trajectories overlaid with within-genotype medians", x="Test time (min)", y = "Blood glucose (mg/dL)",    subtitle = "(First four weeks of data)") +
  theme(legend.position = "bottom", axis.text.x = element_text(angle = 90))

ggplotly(plot1)

```
